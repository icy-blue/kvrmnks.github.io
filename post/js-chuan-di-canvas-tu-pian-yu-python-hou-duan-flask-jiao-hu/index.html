<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>JS传递canvas图片与Python后端Flask交互 | Kvrmnks` blog</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kvrmnks.github.io/favicon.ico?v=1596037643549">
<link rel="stylesheet" href="https://kvrmnks.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="其实这东西是尝试把Neural Model部署在网页上时摸索的

第一步 先整个canvas
&lt;canvas&gt; &lt;/canvas&gt;

好了
第二步 把canvas里的图片整下来
必须要获得canvas的内容才能发到服..." />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kvrmnks.github.io">
        <img src="https://kvrmnks.github.io/images/avatar.png?v=1596037643549" class="site-logo">
        <h1 class="site-title">Kvrmnks` blog</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      power overwhelming
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://kvrmnks.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">JS传递canvas图片与Python后端Flask交互</h2>
            <div class="post-date">2020-07-29</div>
            
            <div class="post-content" v-pre>
              <p>其实这东西是尝试把Neural Model部署在网页上时摸索的</p>
<!--more-->
<h3 id="第一步-先整个canvas">第一步 先整个canvas</h3>
<pre><code class="language-html">&lt;canvas&gt; &lt;/canvas&gt;
</code></pre>
<p><s>好了</s></p>
<h3 id="第二步-把canvas里的图片整下来">第二步 把canvas里的图片整下来</h3>
<p>必须要获得canvas的内容才能发到服务器呀<br>
这里推荐canvas 的dom对象自带的toDataUrl()函数</p>
<pre><code class="language-js">let canvas = document.getElementById('这里写你的canvas的id')
let url = canvas.toDataUrl('Image/png')
</code></pre>
<p>这个方式的参数是可选的，会把canvas的内容进行不同的编码，在进行base64加密<br>
如果不写的话默认是转化成png格式</p>
<h3 id="第三步-把图片url-post到服务器">第三步 把图片url POST到服务器</h3>
<p>这里就简单地用JQuery的POST就好了，别扯乱七八糟的了。<br>
JQuery头部</p>
<pre><code class="language-html">&lt;script src=&quot;https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>POST的使用方法</p>
<pre><code class="language-js">$.post(
    url,
    data,
    func(data, status)
)
</code></pre>
<p>其中url代表要POST到的地址，可以写相对地址的哦。<br>
data是一个字典，代表你要传的内容，这里默认是以text的方式传，不是JSON。<br>
func(data, status) 代表相应之后的回调函数，data表示收到的数据，status代表响应状态。</p>
<p>网页就写完了呢~</p>
<h3 id="第四步-flask-怎么处理-post的数据呢">第四步 Flask 怎么处理 POST的数据呢</h3>
<p>这里要对应上文的一句话 “data是一个字典，代表你要传的内容，这里默认是以text的方式传，不是JSON。”<br>
这里传的是text而不是JSON，Flask的response对于两种类型有着不同的解析方式，这里只介绍text的情况。</p>
<pre><code class="language-python">from Flask import response
data = response.form['POST是字典的Key']
</code></pre>
<p>看起来挺简单的</p>
<h3 id="第五步-传过来的是图片url我咋把它转成图片啊">第五步 传过来的是图片Url我咋把它转成图片啊</h3>
<h4 id="第一小步-把url先解个码转成二进制">第一小步 把Url先解个码，转成二进制</h4>
<pre><code class="language-python">import urllib
data = urllib.request.urlopen(URL)
</code></pre>
<p>就完了，是不是很简单~</p>
<h4 id="第二小步-把二进制转成图片">第二小步 把二进制转成图片</h4>
<p>这里图片使用的是PIL模块<br>
加载PIL的Image</p>
<pre><code class="language-python">from PIL import Image
</code></pre>
<p>然后就能发现Image有个frombytes方法可以从二进制生成图片，但是需要图片大小，这谁知道啊。<s>其实可以从网页发一个呀2333</s></p>
<p>如果你再探索一下就能发现一个令人迷惑的现象，你可以把二进制写成图片，然后用Image读文件生成图片。</p>
<p>那岂不是每次都要做一次文件读写？<br>
当然有方法避免，io.ByteIO()可以提供一个bytes流来模拟文件<br>
使用方法如下</p>
<pre><code class="language-python">    buffer = io.ByteIO()
    buffer.write(你的二进制数据)
    img = Image.open(buffer)
</code></pre>
<p>就好了</p>
<h3 id="第六步-我咋知道图片是什么格式我转格式啊有什么坑啊">第六步 我咋知道图片是什么格式，我转格式啊，有什么坑啊</h3>
<p>关于图片的模式可以通过img.mode查看<br>
已知png图片为RGBA，jpeg图片为RGB<br>
一般转格式都已可以通过convert 但是<br>
把RGBA转成RGB或者灰度图的时候有坑，如果直接通过上面的方法会直接丢失掉透明度，即A<br>
这里还有个迷惑行为是chrome中黑色有的时候用透明度维度表示</p>
<p>然后就没了~</p>

            </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://kvrmnks.github.io/post/ji-qi-xue-xi-ji-chu-da-zuo-ye-jin-cheng-~geng-xin-zhong/">
                  <h3 class="post-title">
                    机器学习基础大作业进程~更新中
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>






  </body>
</html>
